---
title: "Transport Validation"
output:
  word_document: default
  html_document:
      code_folding: hide
  html_notebook:
      code_folding: hide
  pdf_document: default
editor_options: 
  chunk_output_type: console
---

```{r Settings, echo=FALSE}
rm(list=ls())
library(magclass)
library(lusweave)
library(mip)
library(luplot)
library(ggplot2) 
library(quitte) 
library(data.table)
library(utils)
library(rmndt)
library(remind2)
library(madrat)
library(devtools)
load_all("C:/Users/johannah/Documents/EDGE-Transport/Git_clones/edgeTransport")
output_folder="C:/Users/johannah/Documents/EDGE-Transport/Output"
listofruns= list(
  "C:/Users/johannah/Documents/EDGE-Transport/Output/SSP2Refgd40Ref-Mix_2021-12-10_10.25.26",
  "C:/Users/johannah/Documents/EDGE-Transport/Output/SSP2Refgd40Ref_Val4-Mix_2021-12-10_12.25.47", 
  "C:/Users/johannah/Documents/EDGE-Transport/Output/SSP2Refgd40Ref_Val5-Mix_2021-12-10_12.41.08", 
  "C:/Users/johannah/Documents/EDGE-Transport/Output/SSP2Refgd40Ref_Val7-Mix_2021-12-10_13.12.17")

y_bar=c(2010,2030,2050,2100)
reg=NULL
mainReg="GLO"
fileName=paste0("Transport_Val_",format(Sys.time(), "%Y-%m-%d_%H.%M.%S"),".pdf")
sr15marker_RCP=NULL
mrremind_folder="C:/Users/johannah/Documents/EDGE-Transport/EDGE-T_standalone_InputData/mrremind"
load_Cache=TRUE
AggrReg="H12"
#load plotdata
data <- lvl2_generate_plotdata(listofruns, load_Cache, mrremind_folder, AggrReg)

#load historical data 

 ## ---- Read historical data ----
  items <- c("IEA ETP RTS","IEA ETP 2DS","IEA ETP B2DS","IEA","JRC")
  historical <- read.report("C:/Users/johannah/Documents/EDGE-Transport/compScens_vgl_REMIND/CompScen_mifs/historical.mif", as.list = F)
  historical <- historical[,,items, pmatch = F]
  # Clean zeros and global data for JRC
  historical@.Data[historical@.Data == 0] = NA 
  historical["GLO",,"JRC", pmatch = F] = NA

```

## FE Transport

```{r, fig.width=8, fig.height=9}

mainReg <- "GLO"

vars <- c(
  "FE|Transport (EJ/yr)",
  "FE|Transport|Pass (EJ/yr)",
  "FE|Transport|Pass|Rail (EJ/yr)",
  "FE|Transport|Pass|Road|Bus (EJ/yr)",
  "FE|Transport|Pass|Road|LDV (EJ/yr)",
  "FE|Transport|Freight (EJ/yr)",
  "FE|Transport|Freight|Navigation (EJ/yr)",
  "FE|Transport|Freight|Rail (EJ/yr)",
  "FE|Transport|Freight|Road (EJ/yr)")

for (var0 in vars) {
  if (sub(" (.*)", "",var0) %in% unique(data$LinePlot_data$variable)) {
    p1 <- mipLineHistorical(
      data$LinePlot_data[region==mainReg & variable==sub(" (.*)", "",var0)],
      x_hist = historical[mainReg, , var0],
      ylab = var0,
      scales = "free_y",
      xlim = c(1990, 2050)
    )
    print(p1)
    p2 <- mipLineHistorical(data$LinePlot_data[!region==mainReg & variable==sub(" (.*)", "",var0)],
      x_hist = historical[, , var0][mainReg, , , invert = TRUE],
      ylab = var0, scales = "free_y", plot.priority = c("x_hist", "x", "x_proj"), facet.ncol = 3,
      xlim = c(1990, 2050)
    )
    print(p2)
  } else {
    print(paste0(var0, " not in runs"))
  }
}
```

## ES Transport

```{r, fig.width=8, fig.height=9}

mainReg <- "GLO"

vars <- c(
  
  "ES|Transport|Pass (bn pkm/yr)",
  "ES|Transport|Pass|Rail (bn pkm/yr)",
  "ES|Transport|Pass|Road|Bus (bn pkm/yr)",
  "ES|Transport|Pass|Road|LDV (bn pkm/yr)",
  "ES|Transport|Freight|Rail (bn tkm/yr)",
  "ES|Transport|Freight|Road (bn tkm/yr)"
)

for (var0 in vars) {
  if (sub(" (.*)", "",var0) %in% unique(data$LinePlot_data$variable)) {
    p1 <- mipLineHistorical(
      data$LinePlot_data[region==mainReg & variable==sub(" (.*)", "",var0)],
      x_hist = historical[mainReg, , var0],
      ylab = var0,
      scales = "free_y",
      xlim = c(1990, 2050)
    )
    print(p1)
    p2 <- mipLineHistorical(data$LinePlot_data[!region==mainReg & variable==sub(" (.*)", "",var0)],
      x_hist = historical[, , var0][mainReg, , , invert = TRUE],
      ylab = var0, scales = "free_y", plot.priority = c("x_hist", "x", "x_proj"), facet.ncol = 3,
      xlim = c(1990, 2050)
    )
    print(p2)
  } else {
    print(paste0(var0, " not in runs"))
  }
}
```

## EInt Transport

```{r, fig.width=8, fig.height=9}

mainReg <- "GLO"

vars <- c(
  
  "EInt|Transport|Pass|Road|Bus|BEV (MJ/km)",
  "EInt|Transport|Pass|Road|Bus|ICE (MJ/km)",
  "EInt|Transport|Pass|Road|LDV|Midsize Car|BEV (MJ/km)",
  "EInt|Transport|Pass|Road|LDV|Midsize Car|ICE (MJ/km)"
)

for (var0 in vars) {
  if (sub(" (.*)", "",var0) %in% unique(data$LinePlot_data$variable)) {
    p1 <- mipLineHistorical(
      data$LinePlot_data[region==mainReg & variable==sub(" (.*)", "",var0)],
      #x_hist = historical[mainReg, , var0],
      ylab = var0,
      scales = "free_y",
      xlim = c(1990, 2050)
    )
    print(p1)
    p2 <- mipLineHistorical(data$LinePlot_data[!region==mainReg & variable==sub(" (.*)", "",var0)],
      #x_hist = historical[, , var0][mainReg, , , invert = TRUE],
      ylab = var0, scales = "free_y", plot.priority = c("x_hist", "x", "x_proj"), facet.ncol = 3,
      xlim = c(1990, 2050)
    )
    print(p2)
  } else {
    print(paste0(var0, " not in runs"))
  }
}

```


## Prices S2S3

```{r, fig.width=8, fig.height=9}

  p1 <- mipBarYearData(data$Prices_S2S3_Plot_data_LDV[period %in% c(2010,2020, 2030, 2050)],ylab="Prices logit_S2S3 LDV [USD2005/pkm]")
  print(p1)
  p2 <- mipBarYearData(data$Prices_S2S3_Plot_data_Bus[period %in% c(2010,2020, 2030, 2050)],ylab="Prices logit_S2S3 Bus [USD2005/pkm]")
  print(p2)

```  






























